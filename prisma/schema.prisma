generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  subCalendars   SubCalendar[]
  calendarEvents CalendarEvent[]
  projects       Project[]
  tasks          Task[]
  habitCategories HabitCategory[]
  habits          Habit[]
  noteFolders     NoteFolder[]
  notes           Note[]
  goalCategories  GoalCategory[]
  goals           Goal[]
}

model SubCalendar {
  id           String    @id @default(cuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  name         String
  color        String
  isVisible    Boolean   @default(true)
  sortOrder    Int       @default(0)
  icalUrl      String?
  lastSyncedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  events CalendarEvent[]

  @@unique([userId, name])
  @@index([userId])
}

model CalendarEvent {
  id              String    @id @default(cuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  subCalendarId   String
  subCalendar     SubCalendar @relation(fields: [subCalendarId], references: [id], onDelete: Cascade)

  title           String
  description     String?
  location        String?
  startDate       DateTime
  endDate         DateTime
  isAllDay        Boolean   @default(false)

  recurrenceRule  String?
  recurrenceEnd   DateTime?

  parentEventId   String?
  parentEvent     CalendarEvent?  @relation("RecurrenceExceptions", fields: [parentEventId], references: [id], onDelete: Cascade)
  exceptions      CalendarEvent[] @relation("RecurrenceExceptions")
  originalDate    DateTime?

  icalUid           String?
  isLocallyModified Boolean @default(false)
  isLocallyDeleted  Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, startDate, endDate])
  @@index([userId, recurrenceRule])
  @@index([subCalendarId, icalUid])
}

model Project {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  color     String
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tasks Task[]

  @@unique([userId, name])
  @@index([userId])
}

model Task {
  id             String    @id @default(cuid())
  userId         String
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  projectId      String?
  project        Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)

  title          String
  description    String?
  status         String    @default("todo")
  priority       String    @default("medium")

  scheduledDate  DateTime?
  scheduledTime  String?
  dueDate        DateTime?

  recurrenceRule    String?
  recurrenceDay     Int?
  recurrenceEnd     DateTime?

  estimatedDuration Int       @default(60)

  completedAt       DateTime?
  sortOrder      Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([userId, status])
  @@index([userId, scheduledDate])
  @@index([userId, dueDate])
}

model HabitCategory {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  color     String
  icon      String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  habits Habit[]

  @@unique([userId, name])
  @@index([userId])
}

model Habit {
  id              String         @id @default(cuid())
  userId          String
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  categoryId      String?
  category        HabitCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  name            String
  description     String?
  color           String         @default("#6366f1")
  icon            String?

  frequencyType     String         @default("daily")
  frequencyTarget   Int            @default(1)
  frequencyPeriod   String         @default("day")
  frequencyInterval Int            @default(1)
  frequencyDays     String?

  startDate       DateTime       @default(now())
  reminderTime    String?
  isArchived      Boolean        @default(false)
  sortOrder       Int            @default(0)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  completions HabitCompletion[]

  @@index([userId, isArchived])
  @@index([userId, categoryId])
}

model HabitCompletion {
  id          String   @id @default(cuid())
  habitId     String
  habit       Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)
  completedAt DateTime
  count       Int      @default(1)
  note        String?
  createdAt   DateTime @default(now())

  @@unique([habitId, completedAt])
  @@index([habitId, completedAt])
}

model NoteFolder {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  color     String   @default("#6366f1")
  icon      String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  notes Note[]

  @@unique([userId, name])
  @@index([userId])
}

model Note {
  id         String      @id @default(cuid())
  userId     String
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  folderId   String?
  folder     NoteFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)

  title      String
  content    String      @default("")
  color      String      @default("#ffffff")
  tags       String?
  isPinned   Boolean     @default(false)
  isArchived Boolean     @default(false)
  sortOrder  Int         @default(0)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt

  @@index([userId, isArchived])
  @@index([userId, isPinned])
  @@index([userId, folderId])
}

model GoalCategory {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  color     String   @default("#6366f1")
  icon      String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  goals Goal[]

  @@unique([userId, name])
  @@index([userId])
}

model Goal {
  id          String        @id @default(cuid())
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  categoryId  String?
  category    GoalCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  title       String
  description String?
  status      String        @default("active")
  priority    String        @default("medium")
  color          String        @default("#6366f1")
  manualProgress Int?
  targetDate     DateTime?
  completedAt    DateTime?
  isArchived  Boolean       @default(false)
  sortOrder   Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  milestones GoalMilestone[]

  @@index([userId, isArchived])
  @@index([userId, status])
  @@index([userId, categoryId])
}

model GoalMilestone {
  id          String    @id @default(cuid())
  goalId      String
  goal        Goal      @relation(fields: [goalId], references: [id], onDelete: Cascade)
  title       String
  isCompleted Boolean   @default(false)
  completedAt DateTime?
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([goalId])
}

model Module {
  id          String   @id @default(cuid())
  name        String   @unique
  title       String
  description String
  icon        String
  color       String
  href        String
  isActive    Boolean  @default(false)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
