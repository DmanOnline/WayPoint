generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  subCalendars   SubCalendar[]
  calendarEvents CalendarEvent[]
  projects       Project[]
  tasks          Task[]
  habitCategories HabitCategory[]
  habits          Habit[]
  noteFolders     NoteFolder[]
  notes           Note[]
  goalCategories  GoalCategory[]
  goals           Goal[]
  journalEntries  JournalEntry[]
  people          Person[]
}

model SubCalendar {
  id           String    @id @default(cuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  name         String
  color        String
  isVisible    Boolean   @default(true)
  sortOrder    Int       @default(0)
  icalUrl      String?
  lastSyncedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  events CalendarEvent[]

  @@unique([userId, name])
  @@index([userId])
}

model CalendarEvent {
  id              String    @id @default(cuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  subCalendarId   String
  subCalendar     SubCalendar @relation(fields: [subCalendarId], references: [id], onDelete: Cascade)

  title           String
  description     String?
  location        String?
  startDate       DateTime
  endDate         DateTime
  isAllDay        Boolean   @default(false)

  recurrenceRule  String?
  recurrenceEnd   DateTime?

  parentEventId   String?
  parentEvent     CalendarEvent?  @relation("RecurrenceExceptions", fields: [parentEventId], references: [id], onDelete: Cascade)
  exceptions      CalendarEvent[] @relation("RecurrenceExceptions")
  originalDate    DateTime?

  icalUid           String?
  isLocallyModified Boolean @default(false)
  isLocallyDeleted  Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, startDate, endDate])
  @@index([userId, recurrenceRule])
  @@index([subCalendarId, icalUid])
}

model Project {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  color     String
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tasks Task[]

  @@unique([userId, name])
  @@index([userId])
}

model Task {
  id             String    @id @default(cuid())
  userId         String
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  projectId      String?
  project        Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)

  title          String
  description    String?
  status         String    @default("todo")
  priority       String    @default("medium")

  scheduledDate  DateTime?
  scheduledTime  String?
  dueDate        DateTime?

  recurrenceRule    String?
  recurrenceDay     Int?
  recurrenceEnd     DateTime?

  estimatedDuration Int       @default(60)

  completedAt       DateTime?
  sortOrder      Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([userId, status])
  @@index([userId, scheduledDate])
  @@index([userId, dueDate])
}

model HabitCategory {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  color     String
  icon      String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  habits Habit[]

  @@unique([userId, name])
  @@index([userId])
}

model Habit {
  id              String         @id @default(cuid())
  userId          String
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  categoryId      String?
  category        HabitCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  name            String
  description     String?
  color           String         @default("#6366f1")
  icon            String?

  frequencyType     String         @default("daily")
  frequencyTarget   Int            @default(1)
  frequencyPeriod   String         @default("day")
  frequencyInterval Int            @default(1)
  frequencyDays     String?

  startDate       DateTime       @default(now())
  reminderTime    String?
  isArchived      Boolean        @default(false)
  sortOrder       Int            @default(0)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  completions HabitCompletion[]

  @@index([userId, isArchived])
  @@index([userId, categoryId])
}

model HabitCompletion {
  id          String   @id @default(cuid())
  habitId     String
  habit       Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)
  completedAt DateTime
  count       Int      @default(1)
  note        String?
  createdAt   DateTime @default(now())

  @@unique([habitId, completedAt])
  @@index([habitId, completedAt])
}

model NoteFolder {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  color     String   @default("#6366f1")
  icon      String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  notes Note[]

  @@unique([userId, name])
  @@index([userId])
}

model Note {
  id         String      @id @default(cuid())
  userId     String
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  folderId   String?
  folder     NoteFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)

  title      String
  content    String      @default("")
  color      String      @default("#ffffff")
  tags       String?
  isPinned   Boolean     @default(false)
  isArchived Boolean     @default(false)
  sortOrder  Int         @default(0)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt

  @@index([userId, isArchived])
  @@index([userId, isPinned])
  @@index([userId, folderId])
}

model GoalCategory {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  color     String   @default("#6366f1")
  icon      String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  goals Goal[]

  @@unique([userId, name])
  @@index([userId])
}

model Goal {
  id          String        @id @default(cuid())
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  categoryId  String?
  category    GoalCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  title       String
  description String?
  status      String        @default("active")
  priority    String        @default("medium")
  color          String        @default("#6366f1")
  manualProgress Int?
  targetDate     DateTime?
  completedAt    DateTime?
  isArchived  Boolean       @default(false)
  sortOrder   Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  milestones GoalMilestone[]

  @@index([userId, isArchived])
  @@index([userId, status])
  @@index([userId, categoryId])
}

model GoalMilestone {
  id          String    @id @default(cuid())
  goalId      String
  goal        Goal      @relation(fields: [goalId], references: [id], onDelete: Cascade)
  title       String
  isCompleted Boolean   @default(false)
  completedAt DateTime?
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([goalId])
}

model JournalEntry {
  id       String   @id @default(cuid())
  userId   String
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  date     DateTime // day stored as midnight UTC (YYYY-MM-DDT00:00:00.000Z)
  title    String?
  content  String   @default("")
  mood     Int?     // 1â€“5: terrible, bad, okay, good, great
  moodNote String?  // brief note explaining the mood
  energy   Int?     // 1â€“5: leeg, laag, okÃ©, goed, geladen
  gratitude1 String? // dankbaarheid 1
  gratitude2 String? // dankbaarheid 2
  gratitude3 String? // dankbaarheid 3
  tags     String?  // JSON-encoded string[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  personMentions JournalPersonMention[]

  @@unique([userId, date])
  @@index([userId, date])
}

model Person {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  name        String
  nickname    String?
  type        String?  // friend, family, colleague, contact, romantic, mentor
  company     String?
  role        String?
  email       String?
  phone       String?
  birthday    DateTime?
  location    String?
  avatarColor String   @default("#6366f1")
  bio         String?  // vrije tekst over deze persoon
  tags        String?  // JSON-encoded string[]

  contactFrequency String?   // weekly, biweekly, monthly, quarterly, yearly
  metAt            DateTime?
  metThrough       String?   // hoe leren kennen: "via werk", "op een feest"

  isPinned         Boolean   @default(false)
  isArchived       Boolean   @default(false)
  lastContactedAt  DateTime?

  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  interactions     PersonInteraction[]
  followUps        PersonFollowUp[]
  lifeEvents       PersonLifeEvent[]
  relationshipsA   PersonRelationship[] @relation("RelationshipsA")
  relationshipsB   PersonRelationship[] @relation("RelationshipsB")
  journalMentions  JournalPersonMention[]

  @@index([userId, isArchived])
  @@index([userId, type])
}

model PersonInteraction {
  id       String   @id @default(cuid())
  personId String
  person   Person   @relation(fields: [personId], references: [id], onDelete: Cascade)

  date  DateTime @default(now())
  type  String   @default("general") // call, message, meeting, coffee, dinner, video, other
  notes String   @default("")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([personId, date])
}

model PersonFollowUp {
  id       String  @id @default(cuid())
  personId String
  person   Person  @relation(fields: [personId], references: [id], onDelete: Cascade)

  text    String
  isDone  Boolean   @default(false)
  doneAt  DateTime?
  dueDate DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([personId])
}

model PersonLifeEvent {
  id          String   @id @default(cuid())
  personId    String
  person      Person   @relation(fields: [personId], references: [id], onDelete: Cascade)

  date        DateTime
  title       String
  description String?
  icon        String   @default("ðŸ“Œ")

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([personId, date])
}

model PersonRelationship {
  id        String @id @default(cuid())
  personAId String
  personA   Person @relation("RelationshipsA", fields: [personAId], references: [id], onDelete: Cascade)
  personBId String
  personB   Person @relation("RelationshipsB", fields: [personBId], references: [id], onDelete: Cascade)

  type      String   // partner, friend, colleague, family, introduced_by
  label     String?  // vrije tekst beschrijving

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([personAId, personBId])
  @@index([personAId])
  @@index([personBId])
}

model JournalPersonMention {
  id             String       @id @default(cuid())
  journalEntryId String
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)
  personId       String
  person         Person       @relation(fields: [personId], references: [id], onDelete: Cascade)

  createdAt      DateTime     @default(now())

  @@unique([journalEntryId, personId])
  @@index([personId])
  @@index([journalEntryId])
}

model Module {
  id          String   @id @default(cuid())
  name        String   @unique
  title       String
  description String
  icon        String
  color       String
  href        String
  isActive    Boolean  @default(false)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
